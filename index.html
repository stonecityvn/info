<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ESP8266 Remote Panel</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:24px}
.card{border:1px solid #ddd;border-radius:14px;padding:16px;margin:12px 0}
input,button{font-size:16px;padding:8px}
small{color:#666}
</style>
<h2>ESP8266 Remote Panel (GitHub Pages)</h2>
<div class="card">
<h3>1) Cài địa chỉ ESP</h3>
<input id=ip placeholder="vd: 192.168.1.23 hoặc esp8266.local" style="width:260px" />
<button onclick="saveIp()">Lưu</button>
<p><small>Mẹo: nếu dùng mDNS thì gõ <b>esp8266.local</b>. Phải cùng mạng LAN với ESP.</small></p>
</div>
<div class="card">
<h3>2) Giờ hiện tại</h3>
<div id=clock style="font-size:28px;font-weight:600">--:--:--</div>
<button onclick="syncTime()">Sync giờ sang ESP</button>
</div>
<div class="card">
<h3>3) Gửi tin nhắn tới ESP</h3>
<input id=msg placeholder="Nội dung..." style="width:260px" />
<button onclick="sendMsg()">Gửi</button>
<p id=out></p>
</div>
<script>
const LS_KEY='esp_ip';
function getIp(){return localStorage.getItem(LS_KEY)||''}
function saveIp(){localStorage.setItem(LS_KEY, document.getElementById('ip').value.trim()); alert('Đã lưu IP!')}
// clock
setInterval(()=>{const d=new Date();
const z=n=>String(n).padStart(2,'0');
document.getElementById('clock').textContent=`${z(d.getHours())}:${z(d.getMinutes())}:${z(d.getSeconds())}`;
},500);
async function sendMsg(){const ip=getIp(); if(!ip){alert('Chưa cài IP'); return}
const url=`http://${ip}/push?text=`+encodeURIComponent(document.getElementById('msg').value);
try{ const r=await fetch(url); document.getElementById('out').textContent=await r.text(); }
catch(e){ alert('Không gửi được: '+e) }
}
async function syncTime(){const ip=getIp(); if(!ip){alert('Chưa cài IP'); return}
const url=`http://${ip}/time?ts=`+Math.floor(Date.now()/1000);
try{ const r=await fetch(url); alert(await r.text()); }
catch(e){ alert('Lỗi: '+e) }
}
// khởi tạo ip input
window.addEventListener('load',()=>{document.getElementById('ip').value=getIp()||''})
</script>
